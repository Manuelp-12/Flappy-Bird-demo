<!DOCTYPE html>
<html>
    <head>
        <title>Bird</title>
    </head>
    <body>
        <div id="scoreboard" style="display: flex; justify-content: space-between; width: 300px">
            <div>Score: <span id="score">0</span></div>
            <div>High: <span id="high">0</span></div>
        </div>
        <canvas id="gameCanvas" width=300 height=300></canvas>
        <br>
        <button id="reset" onclick=reset()>Reset</button>
    </body>
    <script>
        const gameCanvas = document.getElementById("gameCanvas");
        const context = gameCanvas.getContext("2d");

        context.strokeRect(0, 0, gameCanvas.width, gameCanvas.height);

        //declare bird variable w/ two coordinates
        let bird = {x: 85, y: 150};

        const birdLength = 10; //bird length
        const birdHeight = 10; //bird height
        
        //initialize empty pipes array
        let pipes = [];
        
        var pipeHeight = 0; //random number for where pipes go
        var pipeGap = 35; //distance between pipes
        var pipeWidth = 20; //width of pipes

        const pipeSpawnInterval = 90;
        var frame = 0;

        addPipes();
        drawPipes();

        var jumpHeight = -3.75; //jump height

        const gravity = 0.15;
        let vy = 0;
        let vx = 1.5; //pipe speed

        var score = 0; //user score
        var high = 0;

        var gameOver = false; //ends game

        drawBird();

        document.addEventListener("keydown", function(e) {
            if (e.keyCode === 32) {
                jump();
            }
        })

        document.addEventListener("click", jump);

        requestAnimationFrame(main);

        function main() {          
            clearCanvas();

            drawPipes();
            updatePipes();

            drawBird();
            updateBird();
            
            pipes.forEach(function(pipe) {

                pipe.forEach(function(pipet) {
                    if (collision(bird, pipet)) {
                        gameOver = true; //ends game
                    }
                });

            });

            if (bird.y < 0 || bird.y > gameCanvas.height) {
                gameOver = true; //ends game
            }

            if (gameOver) {
                return;
            }
            else {
                requestAnimationFrame(main);
            }
        }

        function updateBird() {
            bird.y += vy;
            vy += gravity;
        }

        function jump() {
            vy = jumpHeight;
        }

        function clearCanvas() {
            context.fillStyle = '#87CEEB';
            context.strokeStyle = 'black';
            context.fillRect(0, 0, gameCanvas.width, gameCanvas.height);
            context.strokeRect(0, 0, gameCanvas.width, gameCanvas.height);
        }

        function drawBird() {
            context.fillStyle = 'yellow';
            context.strokeStyle = 'black';
            context.fillRect(bird.x, bird.y, birdLength, birdHeight);
            context.strokeRect(bird.x, bird.y, birdLength, birdHeight);
        }


        function random(min, max) {
            return Math.round((Math.random() * (max - min) + min));
        }

        function getPipes() {
            pipeHeight = random(50, gameCanvas.height - 50);
        }

        function addPipes() {
            //1st - top, 2nd - bottom
            getPipes();

            pipes.push([
                {x: gameCanvas.width, y: 0, height: (gameCanvas.height - pipeHeight) - pipeGap}, 
                {x: gameCanvas.width, y: (gameCanvas.height - pipeHeight) + pipeGap, height: pipeHeight},
                false
            ]); //var for if pipe is passed or not
        }

        function drawPipes() {
            context.fillStyle = 'darkgreen';
            context.strokeStyle = 'black';

            pipes.forEach(function(pipe) {
                //top
                context.fillRect(pipe[0].x, pipe[0].y, pipeWidth, pipe[0].height);
                context.strokeRect(pipe[0].x, pipe[0].y, pipeWidth, pipe[0].height);

                //bottom
                context.fillRect(pipe[1].x, pipe[1].y, pipeWidth, pipe[1].height);
                context.strokeRect(pipe[1].x, pipe[1].y, pipeWidth, pipe[1].height);
            });
        }

        function updatePipes() {
            pipes.forEach(function(pipe) {
                pipe[0].x -= vx;
                pipe[1].x -= vx;

                if (!pipe[2] && pipe[0].x + pipeWidth < bird.x) {
                    pipe[2] = true;

                    score++;
                    document.getElementById("score").innerHTML = score;

                    if (score > high) {
                        high = score;
                        document.getElementById("high").innerHTML = high;
                    }
                }
            });

            if (pipes.length > 0 && pipes[0][0].x + pipeWidth < 0) { //remove top element in pipes if off screen
                pipes.shift();
            }

            frame++;
            if (frame % pipeSpawnInterval == 0) {
                addPipes();
            }
        }   

        function collision(a, b) {
            return a.x + birdLength > b.x &&
                   a.x < b.x + pipeWidth &&
                   a.y + birdHeight > b.y &&
                   a.y < b.y + b.height
        }

        function reset() {
            gameOver = false;
            clearCanvas();
            bird = {x: 85, y: 150};
            score = 0;
            document.getElementById("score").innerHTML = score;
            vy = 0;
            pipes = [];
            pipeHeight = 0;
            frame = 0;

            addPipes();
            drawPipes();

            drawBird();           
            
            requestAnimationFrame(main);
        }
    
    </script>
</html>
